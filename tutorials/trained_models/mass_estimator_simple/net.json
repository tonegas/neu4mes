{"Constants": {"Constant100": {"dim": 1, "values": 20.602628835892496},
               "Constant104": {"dim": 1, "values": -1.579244931770138},
               "Constant105": {"dim": 1, "values": 2.769974460279425},
               "Constant84": {"dim": 1, "values": 0.0},
               "Constant85": {"dim": 1, "values": 377.6262110790851},
               "Constant89": {"dim": 1, "values": 0.0},
               "Constant90": {"dim": 1, "values": 3025.1271849788513},
               "Constant94": {"dim": 1, "values": 0.0},
               "Constant95": {"dim": 1, "values": 1114.470293868032},
               "Constant99": {"dim": 1, "values": 4.0},
               "I_wf": {"dim": 1, "values": 2.4},
               "I_wr": {"dim": 1, "values": 2.4},
               "Tyf_min_thresh_neg": {"dim": 1, "values": -200},
               "Tyf_min_thresh_pos": {"dim": 1, "values": 200},
               "g": {"dim": 1, "values": 9.81},
               "i_gear": {"dim": 1, "values": 10.163},
               "lambda_forget": {"dim": 1, "values": 0.995},
               "r_f": {"dim": 1, "values": 0.364},
               "r_r": {"dim": 1, "values": 0.363},
               "reg_fact": {"dim": 1, "values": 0.03},
               "vx_min_thresh": {"dim": 1, "values": 4.0}},
 "Functions": {"FParamFun101": {"code": "def sat_fun(x,x_min,x_max):\n  return torch.min(torch.max(x,x_min),x_max)\n",
                                "in_dim": [{"dim": 1, "sw": 1},
                                           {"dim": 1},
                                           {"dim": 1}],
                                "map_over_dim": false,
                                "n_input": 3,
                                "name": "sat_fun",
                                "out_dim": {"dim": 1, "sw": 1},
                                "params_and_consts": []},
               "FParamFun133": {"code": "def Phi_model(theta, ax,   # inputs\n              g,           # constant (gravitational acceleration)\n              c_r          # learnable parameter (rolling resist. coeff.)\n              ):\n  output = ax + g*torch.sin(theta) + c_r*g*torch.cos(theta)\n  return output\n",
                                "in_dim": [{"dim": 1, "sw": 1},
                                           {"dim": 1, "sw": 1}],
                                "map_over_dim": false,
                                "n_input": 2,
                                "name": "Phi_model",
                                "out_dim": {"dim": 1, "sw": 1},
                                "params_and_consts": ["g", "c_r"]},
               "FParamFun136": {"code": "def y_model(Tyf_engine, Tyf_brake, Tyr_brake, vx, ax,  # inputs\n            I_wf, I_wr, r_f, r_r, i_gear,              # constants\n            c_v, k_d                                   # learnable parameters (linear and quadratic drag)\n            ):\n  # wheel torques\n  T_yf_traction = Tyf_engine*i_gear\n  T_yf = T_yf_traction - Tyf_brake\n  T_yr = -Tyr_brake\n\n  # analytical model formulation, based on the longitudinal vehicle dynamics\n  analytical_model = (-2*I_wf*ax/r_f + T_yf)/r_f + \\\n                     (-2*I_wr*ax/r_r + T_yr)/r_r - c_v*vx - k_d*torch.pow(vx,2)\n\n  # output of the layer\n  output = analytical_model\n  return output\n",
                                "in_dim": [{"dim": 1, "sw": 1},
                                           {"dim": 1, "sw": 1},
                                           {"dim": 1, "sw": 1},
                                           {"dim": 1, "sw": 1},
                                           {"dim": 1, "sw": 1}],
                                "map_over_dim": false,
                                "n_input": 5,
                                "name": "y_model",
                                "out_dim": {"dim": 1, "sw": 1},
                                "params_and_consts": ["I_wf",
                                                      "I_wr",
                                                      "r_f",
                                                      "r_r",
                                                      "i_gear",
                                                      "c_v",
                                                      "k_d"]},
               "FParamFun137": {"code": "def RLS_update(m,    # vehicle mass estimate at the previous time step\n               P,    # covariance of the estimation error at the previous time step\n               Phi,  # regressor at the current time step\n               y,    # measurement model at the current time step\n               Tyf_engine, Tyf_brake, vx,  # inputs\n               i_gear, lambda_forget,  # constants\n               Tyf_min_thresh_pos, Tyf_min_thresh_neg, vx_min_thresh, reg_fact,  # constants\n               ):\n  # compute the total torque at the front wheels\n  Tyf = Tyf_engine*i_gear - Tyf_brake\n\n  # compute the Kalman gain\n  L = P*Phi / (lambda_forget + Phi*P*Phi)\n\n  # update the covariance matrix\n  P_update = (1/lambda_forget) * (P - L*Phi*P)\n\n  # validity functions to freeze the mass estimate:\n  # validity function for the wheel torque: it goes to 0 when Tyf is in [Tyf_min_thresh_neg,Tyf_min_thresh_pos], and 1 otherwise\n  validity_fun_Tyf = 1.0 + (torch.sin(torch.atan((Tyf-Tyf_min_thresh_pos)/reg_fact))+1.0)/2.0 - \\\n                           (torch.sin(torch.atan((Tyf-Tyf_min_thresh_neg)/reg_fact))+1.0)/2.0\n  # vality function for the vehicle speed: it goes to 0 when vx is below vx_min_thresh, and 1 otherwise\n  validity_fun_vx = (torch.sin(torch.atan((vx-vx_min_thresh)/reg_fact))+1.0)/2.0\n  # overall validity function\n  validity_fun = validity_fun_Tyf * validity_fun_vx\n\n  # update the vehicle mass estimate\n  m_update = m + L*(y - Phi*m)*validity_fun\n\n  # return the updated mass estimate and the updated covariance:\n  # concatenate the two tensors along the third dimension, but do not add a new dimension\n  out_tensor = torch.cat((m_update,P_update),dim=2)\n  return out_tensor\n",
                                "in_dim": [{"dim": 1, "sw": 1},
                                           {"dim": 1, "sw": 1},
                                           {"dim": 1, "sw": 1},
                                           {"dim": 1, "sw": 1},
                                           {"dim": 1, "sw": 1},
                                           {"dim": 1, "sw": 1},
                                           {"dim": 1, "sw": 1}],
                                "map_over_dim": false,
                                "n_input": 7,
                                "name": "RLS_update",
                                "out_dim": {"dim": 2, "sw": 1},
                                "params_and_consts": ["i_gear",
                                                      "lambda_forget",
                                                      "Tyf_min_thresh_pos",
                                                      "Tyf_min_thresh_neg",
                                                      "vx_min_thresh",
                                                      "reg_fact"]},
               "FParamFun81": {"code": "def sat_fun(x,x_min,x_max):\n  return torch.min(torch.max(x,x_min),x_max)\n",
                               "in_dim": [{"dim": 1, "sw": 1},
                                          {"dim": 1},
                                          {"dim": 1}],
                               "map_over_dim": false,
                               "n_input": 3,
                               "name": "sat_fun",
                               "out_dim": {"dim": 1, "sw": 1},
                               "params_and_consts": []},
               "FParamFun86": {"code": "def sat_fun(x,x_min,x_max):\n  return torch.min(torch.max(x,x_min),x_max)\n",
                               "in_dim": [{"dim": 1, "sw": 1},
                                          {"dim": 1},
                                          {"dim": 1}],
                               "map_over_dim": false,
                               "n_input": 3,
                               "name": "sat_fun",
                               "out_dim": {"dim": 1, "sw": 1},
                               "params_and_consts": []},
               "FParamFun91": {"code": "def sat_fun(x,x_min,x_max):\n  return torch.min(torch.max(x,x_min),x_max)\n",
                               "in_dim": [{"dim": 1, "sw": 1},
                                          {"dim": 1},
                                          {"dim": 1}],
                               "map_over_dim": false,
                               "n_input": 3,
                               "name": "sat_fun",
                               "out_dim": {"dim": 1, "sw": 1},
                               "params_and_consts": []},
               "FParamFun96": {"code": "def sat_fun(x,x_min,x_max):\n  return torch.min(torch.max(x,x_min),x_max)\n",
                               "in_dim": [{"dim": 1, "sw": 1},
                                          {"dim": 1},
                                          {"dim": 1}],
                               "map_over_dim": false,
                               "n_input": 3,
                               "name": "sat_fun",
                               "out_dim": {"dim": 1, "sw": 1},
                               "params_and_consts": []}},
 "Info": {"SampleTime": 1, "ns": [0, 1], "ntot": 1},
 "Inputs": {"Tyf_brake": {"dim": 1,
                          "ns": [0, 1],
                          "ntot": 1,
                          "sw": [0, 1],
                          "tw": [0, 0]},
            "Tyf_engine": {"dim": 1,
                           "ns": [0, 1],
                           "ntot": 1,
                           "sw": [0, 1],
                           "tw": [0, 0]},
            "Tyr_brake": {"dim": 1,
                          "ns": [0, 1],
                          "ntot": 1,
                          "sw": [0, 1],
                          "tw": [0, 0]},
            "ax": {"dim": 1,
                   "ns": [0, 1],
                   "ntot": 1,
                   "sw": [0, 1],
                   "tw": [0, 0]},
            "m_target": {"dim": 1,
                         "ns": [0, 1],
                         "ntot": 1,
                         "sw": [0, 1],
                         "tw": [0, 0]},
            "theta": {"dim": 1,
                      "ns": [0, 1],
                      "ntot": 1,
                      "sw": [0, 1],
                      "tw": [0, 0]},
            "vx": {"dim": 1,
                   "ns": [0, 1],
                   "ntot": 1,
                   "sw": [0, 1],
                   "tw": [0, 0]}},
 "Minimizers": {"mass_error": {"A": "SamplePart257",
                               "B": "Select252",
                               "loss": "mse"}},
 "Models": "mass_estim",
 "Outputs": {"P_out": "Select253", "m_out": "Select252"},
 "Parameters": {"c_r": {"dim": 1, "sw": 1, "values": [[0.011698853224515915]]},
                "c_v": {"dim": 1, "sw": 1, "values": [[0.0016051162965595722]]},
                "k_d": {"dim": 1, "sw": 1, "values": [[0.996843695640564]]}},
 "Relations": {"ParamFun145": ["ParamFun",
                               ["SamplePart144", "Constant84", "Constant85"],
                               "FParamFun81"],
               "ParamFun156": ["ParamFun",
                               ["SamplePart155", "Constant89", "Constant90"],
                               "FParamFun86"],
               "ParamFun167": ["ParamFun",
                               ["SamplePart166", "Constant94", "Constant95"],
                               "FParamFun91"],
               "ParamFun178": ["ParamFun",
                               ["SamplePart177", "Constant99", "Constant100"],
                               "FParamFun96"],
               "ParamFun189": ["ParamFun",
                               ["SamplePart188", "Constant104", "Constant105"],
                               "FParamFun101"],
               "ParamFun243": ["ParamFun",
                               ["SamplePart242", "ParamFun189"],
                               "FParamFun133"],
               "ParamFun246": ["ParamFun",
                               ["ParamFun145",
                                "ParamFun156",
                                "ParamFun167",
                                "ParamFun178",
                                "ParamFun189"],
                               "FParamFun136"],
               "ParamFun251": ["ParamFun",
                               ["SamplePart248",
                                "SamplePart250",
                                "ParamFun243",
                                "ParamFun246",
                                "ParamFun145",
                                "ParamFun156",
                                "ParamFun178"],
                               "FParamFun137"],
               "SamplePart144": ["SamplePart", ["Tyf_engine"], [0, 1]],
               "SamplePart155": ["SamplePart", ["Tyf_brake"], [0, 1]],
               "SamplePart166": ["SamplePart", ["Tyr_brake"], [0, 1]],
               "SamplePart177": ["SamplePart", ["vx"], [0, 1]],
               "SamplePart188": ["SamplePart", ["ax"], [0, 1]],
               "SamplePart242": ["SamplePart", ["theta"], [0, 1]],
               "SamplePart248": ["SamplePart", ["m"], [0, 1]],
               "SamplePart250": ["SamplePart", ["P"], [0, 1]],
               "SamplePart257": ["SamplePart", ["m_target"], [0, 1]],
               "Select252": ["Select", ["ParamFun251"], 0],
               "Select253": ["Select", ["ParamFun251"], 1]},
 "States": {"P": {"closedLoop": "Select253",
                  "dim": 1,
                  "ns": [0, 1],
                  "ntot": 1,
                  "sw": [0, 1],
                  "tw": [0, 0]},
            "m": {"closedLoop": "Select252",
                  "dim": 1,
                  "ns": [0, 1],
                  "ntot": 1,
                  "sw": [0, 1],
                  "tw": [0, 0]}}}